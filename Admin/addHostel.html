<!DOCTYPE html>
<html>

<head>
    <title>Add Hostel</title>
    <link rel="stylesheet" href="css/navBar.css">
    <link rel="stylesheet" href="css/form.css">
</head>

<body>

    <nav class="navbar">
        <div class="logo">HostelManager</div>
        <ul>
            <li><a href="https://managers-panel.netlify.app/index.html">Dashboard</a></li>
            <li><a href="https://managers-panel.netlify.app/allHostels.html">My Hostels</a></li>
            <li><a href="https://managers-panel.netlify.app/addHostel.html">Add Hostel</a></li>
            <li><a id="logoutBtn" style="cursor:pointer;">Logout</a></li>
        </ul>
    </nav>

    <form class="form" id="addHostelForm">
        <h2>Add Hostel</h2>
        <input placeholder="Hostel Name">
        <input placeholder="City">
        <input placeholder="State">
        <input placeholder="Location">
        <input placeholder="Price">
        <input placeholder="Image URL">
        <textarea placeholder="Facilities (comma separated)"></textarea>
        <button>Add Hostel</button>
    </form>

</body>
<script src="api/api.js"></script>
<script src="api/hostels.js"></script>
<script>

    //========= SECURITY ==========
    const manager = JSON.parse(localStorage.getItem('managerData')) || [];
    (() => {
        if (!manager || manager.length === 0) {
            window.open('https://managers-panel.netlify.app/login.html', '_self')
        }
    })();
    document.getElementById('logoutBtn').onclick = () => {
        localStorage.removeItem('managerData');
        window.open('https://managers-panel.netlify.app/login.html', '_self');
    };


    //========= Add Data Logic ===========
    document.getElementById("addHostelForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const inputs = document.querySelectorAll(".form input, .form textarea");

        //============ Assign Input's value To Variable ===========
        const [
            hostelName,
            city,
            state,
            location,
            price,
            imageUrl,
            facilities
        ] = Array.from(inputs).map(input => input.value.trim());

        /* Null / Empty validation */
        if (
            !hostelName ||
            !city ||
            !state ||
            !location ||
            !price ||
            !imageUrl ||
            !facilities
        ) {
            alert("All fields are required");
            return;
        }

        /* Price validation */
        if (isNaN(price) || Number(price) <= 0) {
            alert("Enter a valid price");
            return;
        }

        const hostelData = {
            managerId: manager[0].id,
            name: hostelName,
            city: city,
            state: state,
            location: `ðŸ“ ${location}`,
            price: Number(price),
            image: imageUrl,
            facilities: facilities.split(",").map(f => f.trim())
        };

        /* Call add hostel method from api/hostel.js*/
        addHostel(hostelData);
        console.log(hostelData);
        this.reset();
    });
</script>

</html>